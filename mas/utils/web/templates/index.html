<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MAS 状态监控</title>
  <!-- 引入 Bootstrap 样式库，用于美化按钮和布局 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      display: flex;                 /* 页面左右布局 */
      min-height: 100vh;             /* 最小高度为视口高度 */
    }
    #sidebar {
      width: 250px;                  /* 左侧边栏宽度 */
      background-color: #f8f9fa;     /* 背景色为浅灰色 */
      padding: 1rem;
      border-right: 1px solid #ddd;  /* 添加右侧边框线 */
    }
    #main {
      flex-grow: 1;                  /* 主内容区域占据剩余空间 */
      padding: 1rem;
      overflow-y: auto;              /* 垂直方向可滚动 */
    }
    .state-card {
      border: 1px solid #ccc;        /* 卡片边框 */
      border-radius: 0.5rem;         /* 圆角 */
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: #ffffff;     /* 背景白色 */
      box-shadow: 0 0 8px rgba(0,0,0,0.05);   /* 轻微阴影 */
    }
    pre {
      white-space: pre-wrap;         /* 自动换行显示 JSON */
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <!-- 左侧控制边栏：状态层级选择 -->
  <div id="sidebar">
    <h5>控制边栏</h5>
    <div class="btn-group-vertical w-100">
      <!-- 点击按钮加载对应状态类型 -->
      <button class="btn btn-outline-primary" onclick="loadState('task')">Task</button>
      <button class="btn btn-outline-primary" onclick="loadState('stage')">Stage</button>
      <button class="btn btn-outline-primary" onclick="loadState('agent')">Agent</button>
      <button class="btn btn-outline-primary" onclick="loadState('step')">Step</button>
    </div>
  </div>

  <!-- 右侧主内容区域 -->
  <div id="main">
    <h3 id="title">请在左侧控制边栏中查看相应状态</h3>
    <div id="stateCards" class="mt-3"></div>
  </div>

  <script>
    /**
     * 根据所选状态类型加载状态信息
     * @param {string} type 状态类型，如 'task'、'stage' 等
     */
    async function loadState(type) {
      // 更新标题为所选状态类型
      document.getElementById('title').innerText = `📦 ${type.toUpperCase()} 状态信息`;

      // 向后端请求状态数据（假设后端 API 为 /api/states?type=xxx）
      const res = await fetch(`/api/states?type=${type}`);
      const data = await res.json();

      // 清空之前的状态卡片内容
      const container = document.getElementById('stateCards');
      container.innerHTML = "";

      // 遍历状态字典，创建卡片
      Object.entries(data).forEach(([id, state]) => {
        const card = document.createElement("div");
        card.className = "state-card";
        card.innerHTML = `
          <h5>${id}</h5>
          <pre>${JSON.stringify(state, null, 2)}</pre>
        `;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>