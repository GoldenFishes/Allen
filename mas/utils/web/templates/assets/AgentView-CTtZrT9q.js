import{ElIcon as e,ElMessage as t,ElTooltip as n,Fragment as r,Transition as i,__plugin_vue_export_helper_default as a,arrow_down_default as o,circle_check_default as s,circle_close_default as c,clock_default as l,computed as u,createBaseVNode as d,createBlock as f,createCommentVNode as p,createElementBlock as m,createVNode as h,defineComponent as g,loading_default as _,normalizeClass as v,onMounted as y,openBlock as b,ref as x,renderList as S,resolveDynamicComponent as C,toDisplayString as w,unref as T,useMasStore as E,useModalStore as D,user_default as O,withCtx as k,withModifiers as A}from"./index-4aQjb5wS.js";import{DetailButton_default as j,SkeletonLoader_default as M}from"./SkeletonLoader-BWvqoc0A.js";const N={class:`agent-card-content`},P={class:`status-indicator`},F={class:`status-text`},I={class:`agent-basic`},L={class:`agent-title`},R=[`data-agent-id`],z={class:`agent-steps`},B=[`onMouseenter`,`onClick`];var V=g({__name:`AgentCard`,props:{agent:{}},emits:[`view-details`,`view-step`],setup(t,{emit:a}){let g=t,y=a,E=x(!1),D=x(null),M=`agent-card-${g.agent.agent_id}`,V=u(()=>g.agent.agent_id.toLowerCase().includes(`human`)||g.agent.conversation_pool!==void 0),H=()=>{g.agent.profile&&(E.value=!E.value)},U=e=>{let t=g.agent.agent_step.step_list.find(t=>t.step_id===e);return t?.execution_state||`init`},W=e=>{let t=g.agent.agent_step.step_list.find(t=>t.step_id===e);return t?.step_intention||`无描述`},G=e=>{let t={idle:`空闲`,working:`工作中`,waiting:`等待中`,finished:`已完成`,failed:`失败`};return t[e]||e},K=e=>{let t={idle:l,working:_,waiting:l,finished:s,failed:c};return t[e]||O},q=e=>{D.value=e},J=()=>{D.value=null},Y=()=>{console.log(`Agent卡片点击:`,g.agent)},X=()=>{console.log(`=== AgentCard Detail Button Clicked ===`),console.log(`Agent ID:`,g.agent.agent_id),console.log(`Agent Name:`,g.agent.name),console.log(`Full Agent Data:`,g.agent),console.log(`Emitting view-details event...`),y(`view-details`,g.agent),console.log(`=== Event emitted ===`)},Z=e=>{y(`view-step`,e)};return(t,a)=>{let s=e,c=n;return b(),m(`div`,{class:v([`agent-card`,{"human-border":V.value}]),"data-component-id":M,onClick:Y},[d(`div`,N,[d(`div`,{class:v([`agent-status-bar`,`status-${t.agent.working_state}`])},[d(`div`,P,[h(s,null,{default:k(()=>[(b(),f(C(K(t.agent.working_state))))]),_:1})]),d(`span`,F,w(G(t.agent.working_state)),1)],2),d(`div`,{class:`agent-info`,onClick:A(H,[`stop`])},[d(`div`,I,[d(`span`,L,w(`[${t.agent.role}] ${t.agent.name}`),1),t.agent.profile?(b(),f(s,{key:0,class:v([`expand-icon`,{rotated:E.value}])},{default:k(()=>[h(T(o))]),_:1},8,[`class`])):p(``,!0)]),h(i,{name:`profile-expand`},{default:k(()=>[E.value?(b(),m(`div`,{key:0,class:`agent-profile`,"data-agent-id":t.agent.agent_id},w(t.agent.profile),9,R)):p(``,!0)]),_:1})]),d(`div`,z,[(b(!0),m(r,null,S(t.agent.agent_step.todo_list,e=>(b(),m(`div`,{key:e,class:v([`step-block`,`status-${U(e)}`]),onMouseenter:t=>q(e),onMouseleave:J,onClick:A(t=>Z(e),[`stop`])},[h(c,{content:D.value===e?W(e):``,placement:`top`,disabled:D.value!==e},{default:k(()=>a[0]||=[d(`div`,{class:`step-content`},null,-1)]),_:2,__:[0]},1032,[`content`,`disabled`])],42,B))),128))])]),h(j,{theme:`purple`,sizeType:`medium`,onClick:X})],2)}}}),H=a(V,[[`__scopeId`,`data-v-4bd3300c`]]);const U={class:`agent-view`},W={key:0,class:`loading-container`},G={key:1,class:`empty-state`},K=[`disabled`],q={key:2,class:`agent-grid`};var J=g({__name:`AgentView`,setup(e){let n=E(),i=D(),a=x(!1),o=e=>n.agents.filter(t=>t.working_state===e).length,s=u(()=>n.agents.filter(e=>e.agent_id.toLowerCase().includes(`human`)||e.conversation_pool!==void 0).length),c=async()=>{a.value=!0;try{await Promise.all([n.getAgents(),n.getSteps()])}catch(e){t.error(`获取数据失败`),console.error(`Failed to refresh data:`,e)}finally{a.value=!1}},l=e=>{console.log(`=== handleViewDetails Called ===`),console.log(`Agent received:`,e),console.log(`Agent ID:`,e.agent_id),console.log(`Agent Name:`,e.name),console.log(`modalStore available:`,!!i),console.log(`modalStore methods:`,Object.keys(i));try{console.log(`Creating modal...`),i.createModal({type:`agent`,title:`Agent详情 - ${e.name}`,id:e.agent_id,data:e,componentProps:{agentData:e}})}catch(e){console.error(`Error creating modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Agent详情失败`)}},p=e=>{console.log(`=== handleViewStep Called ===`),console.log(`Step ID:`,e),console.log(`modalStore available:`,!!i),console.log(`Current steps in store:`,n.steps.length);try{let r=n.getStepById(e);if(!r){console.error(`Step not found:`,e),console.log(`Available steps:`,n.steps.map(e=>e.step_id)),t.error(`未找到步骤信息 (ID: ${e})`);return}console.log(`Step found:`,r),console.log(`Creating step modal...`),i.createModal({type:`step`,title:`Step详情 - [${r.type}] ${r.executor}`,id:r.step_id,data:r,componentProps:{data:r}})}catch(e){console.error(`Error creating step modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Step详情失败`)}};return y(()=>{c()}),(e,t)=>(b(),m(`div`,U,[a.value?(b(),m(`div`,W,[h(M,{type:`agent`,count:8})])):T(n).agents.length===0?(b(),m(`div`,G,[t[0]||=d(`div`,{class:`empty-icon`},`👤`,-1),t[1]||=d(`div`,{class:`empty-text`},[d(`h3`,null,`暂无Agent数据`),d(`p`,null,`当前系统中没有智能体信息，请刷新或等待Agent创建。`)],-1),d(`button`,{onClick:c,class:`refresh-button`,disabled:a.value},w(a.value?`刷新中...`:`刷新数据`),9,K)])):(b(),m(`div`,q,[(b(!0),m(r,null,S(T(n).agents,e=>(b(),f(H,{key:e.agent_id,agent:e,onViewDetails:l,onViewStep:p},null,8,[`agent`]))),128))]))]))}}),Y=a(J,[[`__scopeId`,`data-v-19ce6567`]]);export{Y as default};