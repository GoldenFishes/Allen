import{ElIcon as e,ElMessage as t,ElTooltip as n,Fragment as r,__plugin_vue_export_helper_default as i,circle_check_default as a,circle_close_default as o,clock_default as s,computed as c,createBaseVNode as l,createBlock as u,createCommentVNode as d,createElementBlock as f,createVNode as p,defineComponent as m,getStatusColor as h,loading_default as g,normalizeClass as _,normalizeStyle as v,onMounted as y,onUnmounted as b,openBlock as x,ref as S,renderList as C,resolveDirective as w,resolveDynamicComponent as T,toDisplayString as E,useMasStore as D,useModalStore as O,user_default as k,withCtx as A,withDirectives as j}from"./index-C9R2NF0z.js";import{DetailButton_default as M,SkeletonLoader_default as N}from"./SkeletonLoader-OggZPTEo.js";import{StatusIndicator_default as P}from"./StatusIndicator-D7ANoUZ1.js";const F={class:`agent-info-card`},I={class:`agent-status-section`},L={class:`status-indicator-wrapper`},R={class:`agent-content`},z={class:`agent-info-section`},B={class:`agent-role-name`},V={class:`agent-display`};var H=m({__name:`AgentInfoCard`,props:{agent:{}},emits:[`detailClick`],setup(t,{emit:r}){let i=t,c=r,d=e=>{let t={idle:k,working:g,waiting:s,finished:a,failed:o};return t[e]||k},m=e=>{let t={idle:`空闲`,working:`工作中`,waiting:`等待中`,finished:`已完成`,failed:`失败`};return t[e]||e},h=()=>{c(`detailClick`,i.agent)};return(t,r)=>{let i=e,a=n;return x(),f(`div`,F,[l(`div`,I,[l(`div`,L,[p(a,{content:m(t.agent.working_state),placement:`top`},{default:A(()=>[l(`div`,{class:_([`status-indicator`,`status-${t.agent.working_state}`])},[p(i,null,{default:A(()=>[(x(),u(T(d(t.agent.working_state))))]),_:1})],2)]),_:1},8,[`content`])])]),l(`div`,R,[l(`div`,z,[l(`div`,B,[l(`span`,V,`[`+E(t.agent.role)+`] `+E(t.agent.name),1)])])]),p(M,{theme:`purple`,sizeType:`small`,onClick:h})])}}}),U=i(H,[[`__scopeId`,`data-v-73ad6970`]]);const ee={class:`step-flip-card-face step-flip-card-front`},W={key:0,class:`step-compact`},G={class:`step-flip-card-face step-flip-card-back`},K={class:`step-status-indicator`},q={class:`step-content`},J={class:`step-type-executor`},Y={class:`executor`},X={class:`step-intention`};var Z=m({__name:`StepCard`,props:{step:{}},emits:[`detailClick`],setup(e,{emit:t}){let n=e,r=t,i=S(!1),a=null,o=c(()=>h(n.step.execution_state)),s=e=>e===`skill`?`type--skill`:`type--tool`,u=e=>{let t={init:`step-expanded--init`,pending:`step-expanded--pending`,running:`step-expanded--running`,finished:`step-expanded--finished`,failed:`step-expanded--failed`};return t[e]||`step-expanded--init`},m=()=>{y(),i.value=!0},g=()=>{a=setTimeout(()=>{i.value=!1},3e4)},y=()=>{a&&(clearTimeout(a),a=null)},C=()=>{r(`detailClick`,n.step)};return b(()=>{y()}),(e,t)=>{let n=w(`markdown`);return x(),f(`div`,{class:_([`step-flip-card`,{flipped:i.value}]),onMouseenter:m,onMouseleave:g},[l(`div`,ee,[i.value?d(``,!0):(x(),f(`div`,W,[l(`div`,{class:`status-block`,style:v({backgroundColor:o.value})},null,4)]))]),l(`div`,G,[i.value?(x(),f(`div`,{key:0,class:_([`step-expanded`,u(e.step.execution_state)])},[l(`div`,K,[p(P,{status:e.step.execution_state,tooltip:e.step.execution_state},null,8,[`status`,`tooltip`])]),l(`div`,q,[l(`div`,J,[l(`span`,{class:_([`type`,s(e.step.type)])},` [`+E(e.step.type)+`] `,3),l(`span`,Y,E(e.step.executor),1)]),j(l(`div`,X,null,512),[[n,e.step.step_intention]])])],2)):d(``,!0),p(M,{theme:`purple`,sizeType:`small`,onClick:C})])],34)}}}),Q=i(Z,[[`__scopeId`,`data-v-4da14faa`]]);const $={class:`step-view`},te={key:0,class:`loading-container`},ne={key:1,class:`empty-state`},re={key:2},ie={class:`step-list`};var ae=m({__name:`StepView`,setup(e){let n=D(),i=O(),a=S(!1),o=c(()=>{let e=n.groupStepsByAgent();return e.forEach(e=>{console.log(`Agent ${e.agent.name} (${e.agentId}) step order:`,{todoList:e.agent.agent_step?.todo_list||[],stepIds:e.steps.map(e=>e.step_id),stepIntentions:e.steps.map(e=>e.step_intention)})}),e}),s=S(),d=e=>e.agent_id.includes(`Human`)||e.conversation_pool,m=async()=>{a.value=!0;try{await Promise.all([n.getSteps(),n.getAgents()])}catch(e){t.error(`获取数据失败`),console.error(`Failed to refresh data:`,e)}finally{a.value=!1}};y(async()=>{await m()});let h=e=>{console.log(`=== handleViewAgentDetail Called ===`),console.log(`Agent received:`,e),console.log(`Agent ID:`,e.agent_id),console.log(`Agent Name:`,e.name),console.log(`modalStore available:`,!!i),console.log(`modalStore methods:`,Object.keys(i));try{console.log(`Creating modal...`),i.createModal({type:`agent`,title:`Agent详情 - ${e.name}`,id:e.agent_id,data:e,componentProps:{agentData:e}})}catch(e){console.error(`Error creating modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Agent详情失败`)}},g=e=>{console.log(`=== handleViewStepDetail Called ===`),console.log(`Step received:`,e),console.log(`Step ID:`,e.step_id),console.log(`Step type:`,e.type),console.log(`modalStore available:`,!!i);try{console.log(`Creating step modal...`);let t=i.createModal({type:`step`,title:`Step详情 - [${e.type}] ${e.executor}`,id:e.step_id,data:e,componentProps:{data:e}});console.log(`Step modal created successfully:`,t),console.log(`Modal ID:`,t.id),console.log(`Modal data:`,t.data)}catch(e){console.error(`Error creating step modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Step详情失败`)}};return(e,t)=>(x(),f(`div`,$,[a.value?(x(),f(`div`,te,[p(N,{type:`step`,count:4})])):o.value.length?(x(),f(`div`,re,[(x(!0),f(r,null,C(o.value,e=>(x(),f(`div`,{key:e.agentId,class:`agent-row`},[p(U,{agent:e.agent,class:_([`agent-info-fixed`,{"human-agent":d(e.agent)}]),onDetailClick:h},null,8,[`agent`,`class`]),l(`div`,{class:`step-list-container`,ref_for:!0,ref_key:`stepContainer`,ref:s},[l(`div`,ie,[(x(!0),f(r,null,C(e.steps,(e,t)=>(x(),u(Q,{key:`${e.step_id}-${t}`,step:e,index:t,class:_({"animate-step":!0}),style:v({animationDelay:`${.1+t*.05}s`}),onDetailClick:g},null,8,[`step`,`index`,`style`]))),128))])],512)]))),128))])):(x(),f(`div`,ne,[t[0]||=l(`div`,{class:`empty-icon`},`🔧`,-1),t[1]||=l(`div`,{class:`empty-text`},[l(`h3`,null,`暂无步骤数据`),l(`p`,null,`当前没有可显示的步骤信息，请检查数据连接或稍后重试。`)],-1),l(`button`,{onClick:m,class:`refresh-button`},`刷新数据`)]))]))}}),oe=i(ae,[[`__scopeId`,`data-v-8cfde202`]]);export{oe as default};