import{ElIcon as e,ElMessage as t,ElTooltip as n,Fragment as r,__plugin_vue_export_helper_default as i,circle_check_default as a,circle_close_default as o,clock_default as s,computed as c,createBaseVNode as l,createBlock as u,createCommentVNode as d,createElementBlock as f,createVNode as p,defineComponent as m,getStatusColor as h,loading_default as g,normalizeClass as _,normalizeStyle as v,onMounted as y,onUnmounted as b,openBlock as x,ref as S,renderList as C,resolveDirective as w,resolveDynamicComponent as T,toDisplayString as E,useMasStore as D,useModalStore as O,user_default as k,withCtx as A,withDirectives as j}from"./index-_7negxDj.js";import{DetailButton_default as M,SkeletonLoader_default as N}from"./SkeletonLoader-Co4bhN4n.js";import{StatusIndicator_default as P}from"./StatusIndicator-D5XBEbp3.js";const F={class:`agent-info-card`},I={class:`agent-status-section`},L={class:`status-indicator-wrapper`},R={class:`agent-content`},z={class:`agent-info-section`},B={class:`agent-role-name`},V={class:`agent-display`};var H=m({__name:`AgentInfoCard`,props:{agent:{}},emits:[`detailClick`],setup(t,{emit:r}){let i=t,c=r,d=e=>{let t={idle:k,working:g,waiting:s,finished:a,failed:o};return t[e]||k},m=e=>{let t={idle:`空闲`,working:`工作中`,waiting:`等待中`,finished:`已完成`,failed:`失败`};return t[e]||e},h=()=>{c(`detailClick`,i.agent)};return(t,r)=>{let i=e,a=n;return x(),f(`div`,F,[l(`div`,I,[l(`div`,L,[p(a,{content:m(t.agent.working_state),placement:`top`},{default:A(()=>[l(`div`,{class:_([`status-indicator`,`status-${t.agent.working_state}`])},[p(i,null,{default:A(()=>[(x(),u(T(d(t.agent.working_state))))]),_:1})],2)]),_:1},8,[`content`])])]),l(`div`,R,[l(`div`,z,[l(`div`,B,[l(`span`,V,`[`+E(t.agent.role)+`] `+E(t.agent.name),1)])])]),p(M,{theme:`purple`,sizeType:`small`,onClick:h})])}}}),U=i(H,[[`__scopeId`,`data-v-73ad6970`]]);const ee={class:`step-flip-card-face step-flip-card-front`},W={key:0,class:`step-compact`},G={class:`step-flip-card-face step-flip-card-back`},K={class:`step-header`},q={class:`step-status-indicator`},J={class:`step-type`},Y={class:`step-content`},X={class:`step-executor`},Z={class:`executor`},Q={class:`step-intention`};var $=m({__name:`StepCard`,props:{step:{}},emits:[`detailClick`],setup(e,{emit:t}){let n=e,r=t,i=S(!1),a=null,o=c(()=>h(n.step.execution_state)),s=e=>e===`skill`?`type--skill`:`type--tool`,u=e=>{let t={init:`step-expanded--init`,pending:`step-expanded--pending`,running:`step-expanded--running`,finished:`step-expanded--finished`,failed:`step-expanded--failed`};return t[e]||`step-expanded--init`},m=()=>{y(),i.value=!0},g=()=>{a=setTimeout(()=>{i.value=!1},3e4)},y=()=>{a&&(clearTimeout(a),a=null)},C=()=>{r(`detailClick`,n.step)};return b(()=>{y()}),(e,t)=>{let n=w(`markdown`);return x(),f(`div`,{class:_([`step-flip-card`,{flipped:i.value}]),onMouseenter:m,onMouseleave:g},[l(`div`,ee,[i.value?d(``,!0):(x(),f(`div`,W,[l(`div`,{class:`status-block`,style:v({backgroundColor:o.value})},null,4)]))]),l(`div`,G,[i.value?(x(),f(`div`,{key:0,class:_([`step-expanded`,u(e.step.execution_state)])},[l(`div`,K,[l(`div`,q,[p(P,{status:e.step.execution_state,tooltip:e.step.execution_state},null,8,[`status`,`tooltip`])]),l(`div`,J,[l(`span`,{class:_([`type`,s(e.step.type)])},E(e.step.type),3)])]),l(`div`,Y,[l(`div`,X,[l(`span`,Z,E(e.step.executor),1)]),j(l(`div`,Q,null,512),[[n,e.step.step_intention]])])],2)):d(``,!0),p(M,{theme:`purple`,sizeType:`small`,onClick:C})])],34)}}}),te=i($,[[`__scopeId`,`data-v-5a5eba19`]]);const ne={class:`step-view`},re={key:0,class:`loading-container`},ie={key:1,class:`empty-state`},ae={key:2},oe={class:`step-list`};var se=m({__name:`StepView`,setup(e){let n=D(),i=O(),a=S(!1),o=c(()=>{let e=n.groupStepsByAgent();return e.forEach(e=>{}),e}),s=S(),d=e=>e.agent_id.includes(`Human`)||e.conversation_pool,m=async()=>{a.value=!0;try{await Promise.all([n.getSteps(),n.getAgents()])}catch(e){t.error(`获取数据失败`),console.error(`Failed to refresh data:`,e)}finally{a.value=!1}};y(async()=>{await m()});let h=e=>{try{i.createModal({type:`agent`,title:`Agent详情 - ${e.name}`,id:e.agent_id,data:e,componentProps:{agentData:e}})}catch(e){console.error(`Error creating modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Agent详情失败`)}},g=e=>{try{let t=i.createModal({type:`step`,title:`Step详情 - [${e.type}] ${e.executor}`,id:e.step_id,data:e,componentProps:{data:e}})}catch(e){console.error(`Error creating step modal:`,e),console.error(`Error stack:`,e instanceof Error?e.stack:`No stack trace`),t.error(`打开Step详情失败`)}};return(e,t)=>(x(),f(`div`,ne,[a.value?(x(),f(`div`,re,[p(N,{type:`step`,count:4})])):o.value.length?(x(),f(`div`,ae,[(x(!0),f(r,null,C(o.value,e=>(x(),f(`div`,{key:e.agentId,class:`agent-row`},[p(U,{agent:e.agent,class:_([`agent-info-fixed`,{"human-agent":d(e.agent)}]),onDetailClick:h},null,8,[`agent`,`class`]),l(`div`,{class:`step-list-container`,ref_for:!0,ref_key:`stepContainer`,ref:s},[l(`div`,oe,[(x(!0),f(r,null,C(e.steps,(e,t)=>(x(),u(te,{key:`${e.step_id}-${t}`,step:e,index:t,class:_({"animate-step":!0}),style:v({animationDelay:`${.1+t*.05}s`}),onDetailClick:g},null,8,[`step`,`index`,`style`]))),128))])],512)]))),128))])):(x(),f(`div`,ie,[t[0]||=l(`div`,{class:`empty-icon`},`🔧`,-1),t[1]||=l(`div`,{class:`empty-text`},[l(`h3`,null,`暂无步骤数据`),l(`p`,null,`当前没有可显示的步骤信息，请检查数据连接或稍后重试。`)],-1),l(`button`,{onClick:m,class:`refresh-button`},`刷新数据`)]))]))}}),ce=i(se,[[`__scopeId`,`data-v-2df9efa3`]]);export{ce as default};