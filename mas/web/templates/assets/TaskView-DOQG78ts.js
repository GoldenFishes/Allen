import{ElIcon as e,ElMessage as t,ElTooltip as n,Fragment as r,__plugin_vue_export_helper_default as i,_export_sfc as a,avatar_default as o,buildProps as s,circle_check_default as c,circle_close_default as l,clock_default as u,createBaseVNode as d,createBlock as f,createCommentVNode as p,createElementBlock as m,createTextVNode as h,createVNode as g,defineComponent as _,definePropType as v,loading_default as y,normalizeClass as b,normalizeStyle as x,onMounted as S,openBlock as C,ref as w,renderList as T,renderSlot as E,resolveDynamicComponent as D,set_up_default as O,toDisplayString as k,unref as A,useMasStore as j,useModalStore as M,useNamespace as N,user_default as P,user_filled_default as F,withCtx as I,withInstall as L,withModifiers as R}from"./index-_7negxDj.js";import{DetailButton_default as z,SkeletonLoader_default as B}from"./SkeletonLoader-Co4bhN4n.js";const V=s({header:{type:String,default:``},footer:{type:String,default:``},bodyStyle:{type:v([String,Object,Array]),default:``},headerClass:String,bodyClass:String,footerClass:String,shadow:{type:String,values:[`always`,`hover`,`never`],default:`always`}}),H=_({name:`ElCard`}),U=_({...H,props:V,setup(e){let t=N(`card`);return(e,n)=>(C(),m(`div`,{class:b([A(t).b(),A(t).is(`${e.shadow}-shadow`)])},[e.$slots.header||e.header?(C(),m(`div`,{key:0,class:b([A(t).e(`header`),e.headerClass])},[E(e.$slots,`header`,{},()=>[h(k(e.header),1)])],2)):p(`v-if`,!0),d(`div`,{class:b([A(t).e(`body`),e.bodyClass]),style:x(e.bodyStyle)},[E(e.$slots,`default`)],6),e.$slots.footer||e.footer?(C(),m(`div`,{key:1,class:b([A(t).e(`footer`),e.footerClass])},[E(e.$slots,`footer`,{},()=>[h(k(e.footer),1)])],2)):p(`v-if`,!0)],2))}});var W=a(U,[[`__file`,`card.vue`]]);const G=L(W);function K(){let e=w(!1),t=w(!1),n=()=>{e.value=!0},r=()=>{t.value=!0},i=()=>{t.value=!1},a=()=>({opacity:e.value?1:0,transform:e.value?`translateY(0)`:`translateY(20px)`,transition:`all 0.6s cubic-bezier(0.4, 0, 0.2, 1)`}),o=()=>({transform:t.value?`translateY(-4px) scale(1.02)`:`translateY(0) scale(1)`,boxShadow:t.value?`0 12px 30px rgba(0, 0, 0, 0.15)`:`0 4px 12px rgba(0, 0, 0, 0.08)`});return S(()=>{setTimeout(n,100)}),{isVisible:e,isHovered:t,animateIn:n,handleMouseEnter:r,handleMouseLeave:i,getAnimationStyle:a,getHoverStyle:o}}const q=async(e,n=`内容已复制到剪贴板`,r=`复制失败`)=>{try{return await navigator.clipboard.writeText(e),t.success(n),!0}catch(e){return t.error(r),console.error(`Copy failed:`,e),!1}},J=async e=>q(e,`任务名称已复制到剪贴板`),Y=async e=>q(e,`任务ID已复制到剪贴板`),X=async e=>q(e,`Agent ID已复制到剪贴板`),Z=async e=>q(e,`阶段ID已复制到剪贴板`),Q=async e=>q(e,`步骤ID已复制到剪贴板`),$=()=>({copyToClipboard:q,copyTaskName:J,copyTaskId:Y,copyAgentId:X,copyStageId:Z,copyStepId:Q,createCopyHandler:(e,t,n)=>async()=>{await q(e,t,n)},createTaskCopyHandlers:e=>({handleCopyTaskId:async()=>Y(e.task_id),handleCopyTaskName:async()=>J(e.task_name)})}),ee={class:`h-full overflow-hidden flex flex-col`},te={class:`task-header`},ne={class:`task-status`},re={class:`task-content`},ie={class:`stage-progress`},ae={class:`progress-label`},oe={class:`stage-blocks`},se=[`onClick`],ce={class:`task-group`},le={class:`group-label`},ue={class:`agent-blocks`},de=[`onClick`];var fe=_({__name:`TaskCard`,props:{task:{}},emits:[`view-details`,`view-stage`,`view-agent`],setup(t,{emit:i}){let a=t,s=i,p=j(),{createTaskCopyHandlers:_}=$(),{handleCopyTaskName:v}=_(a.task),{handleMouseEnter:S,handleMouseLeave:w,getAnimationStyle:E,getHoverStyle:M}=K(),N=e=>{let t={init:u,pending:u,running:y,finished:c,failed:l};return t[e]||u},L=e=>{let t={init:`init`,pending:`pending`,running:`running`,finished:`finished`,failed:`failed`};return t[e]||e},B=e=>e.includes(`Human`)||e.includes(`human`),V=e=>B(e)?o:P,H=e=>p.getAgentDisplayInfo(e),U=e=>p.getAgentWorkingState(e),W=e=>{let t=H(e);return`[${t.role}] ${t.name}`};return(t,i)=>{let a=e,o=n,s=G;return C(),f(s,{class:b([`task-card`,`status-${t.task.execution_state}`]),style:x({...A(E)(),...A(M)()}),onMouseenter:A(S),onMouseleave:A(w)},{default:I(()=>[d(`div`,ee,[d(`div`,te,[d(`div`,ne,[g(o,{content:L(t.task.execution_state),placement:`top`},{default:I(()=>[d(`div`,{class:b([`status-indicator`,`status-${t.task.execution_state}`])},[g(a,null,{default:I(()=>[(C(),f(D(N(t.task.execution_state))))]),_:1})],2)]),_:1},8,[`content`])]),d(`div`,{class:`task-name`,onClick:i[0]||=R((...e)=>A(v)&&A(v)(...e),[`stop`])},k(t.task.task_name),1)]),d(`div`,re,[d(`div`,ie,[d(`div`,ae,[g(a,null,{default:I(()=>[g(A(O))]),_:1}),h(` 阶段进度 (`+k(t.task.stage_list.length)+`) `,1)]),d(`div`,oe,[(C(!0),m(r,null,T(t.task.stage_list,e=>(C(),f(o,{key:e.stage_id,content:e.stage_intention,placement:`top`,disabled:!e.stage_intention},{default:I(()=>[d(`div`,{class:b([`stage-block`,`status-${e.execution_state}`]),onClick:R(n=>t.$emit(`view-stage`,e.stage_id),[`stop`])},null,10,se)]),_:2},1032,[`content`,`disabled`]))),128))])]),d(`div`,ce,[d(`div`,le,[g(a,null,{default:I(()=>[g(A(F))]),_:1}),h(` 参与智能体 (`+k(t.task.task_group.length)+`) `,1)]),d(`div`,ue,[(C(!0),m(r,null,T(t.task.task_group,e=>(C(),f(o,{key:e,content:W(e),placement:`top`},{default:I(()=>[d(`div`,{class:b([`agent-block`,{"is-manager":e===t.task.task_manager,"is-human":B(e),[`status-${U(e)}`]:!0}]),onClick:R(n=>t.$emit(`view-agent`,e),[`stop`])},[g(a,null,{default:I(()=>[(C(),f(D(V(e))))]),_:2},1024)],10,de)]),_:2},1032,[`content`]))),128))])])]),g(z,{theme:`red`,onClick:i[1]||=e=>t.$emit(`view-details`,t.task)})])]),_:1},8,[`class`,`style`,`onMouseenter`,`onMouseleave`])}}}),pe=i(fe,[[`__scopeId`,`data-v-63193207`]]);const me={class:`task-view`},he={key:0,class:`loading-container`},ge={key:1,class:`empty-state`},_e=[`disabled`],ve={key:2,class:`task-grid`};var ye=_({__name:`TaskView`,setup(e){let n=j(),i=M(),a=w(!1),o=e=>n.tasks.filter(t=>t.execution_state===e).length,s=async()=>{a.value=!0;try{await Promise.all([n.getTask(),n.getAgents()])}catch(e){t.error(`获取数据失败`),console.error(`Failed to refresh data:`,e)}finally{a.value=!1}},c=e=>{i.createModal({type:`task`,title:`Task详情 - ${e.task_name}`,id:e.task_id,data:e,slots:{default:`TaskInfo`},componentProps:{taskData:e}})},l=e=>{},u=e=>{};return S(()=>{s()}),(e,t)=>(C(),m(`div`,me,[a.value?(C(),m(`div`,he,[g(B,{type:`task`,count:6})])):A(n).tasks.length===0?(C(),m(`div`,ge,[t[0]||=d(`div`,{class:`empty-icon`},`📋`,-1),t[1]||=d(`div`,{class:`empty-text`},[d(`h3`,null,`暂无任务数据`),d(`p`,null,`当前系统中没有任务信息，请刷新或等待任务创建。`)],-1),d(`button`,{onClick:s,class:`refresh-button`,disabled:a.value},k(a.value?`刷新中...`:`刷新数据`),9,_e)])):(C(),m(`div`,ve,[(C(!0),m(r,null,T(A(n).tasks,e=>(C(),f(pe,{key:e.task_id,task:e,onViewDetails:c,onViewStage:l,onViewAgent:u},null,8,[`task`]))),128))]))]))}}),be=i(ye,[[`__scopeId`,`data-v-64269fab`]]);export{be as default};